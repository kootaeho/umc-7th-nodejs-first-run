<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>내 API 테스트하기</title>
</head>
<body>
    <h1>회원가입 테스트</h1>
    <button id="signupButton">가입 요청 (성공)</button>
    <button id="signupButtonFail">가입 요청 (실패 - 이메일 중복)</button>

    <script>
       
        const API_URL = 'http://localhost:3000';

        // 성공 테스트 
        document.getElementById('signupButton').onclick = async () => {
            const userData = {
                email: `test_${Date.now()}@test.com`, // 매번 다른 이메일
                name: "UMC",
                gender: "여성",
                birth: "2000-01-01",
                address: "서울시",
                detailAddress: "UMC구 챌린저동 화이팅아파트",
                phoneNumber: "010-1234-5678",
                preferences: [1]
            };
            
            await callAPI('/api/v1/users/signup', userData);
        };

        // 2. 실패 테스트 (이메일 중복)
        document.getElementById('signupButtonFail').onclick = async () => {
            const userData = {
                email: "test@example.com", // 이미 가입된 이메일 사용 
                name: "UMC",
                gender: "여성",            
                birth: "2000-01-01", 
                address: "서울시",
                detailAddress: "UMC구 챌린저동 화이팅아파트",
                phoneNumber: "010-1234-5678",
                preferences: [1]
            };
            
            await callAPI('/api/v1/users/signup', userData);
        };

        // 3. API 호출 함수
        async function callAPI(path, data) {
            console.log(`%c[요청] ${path}`, 'color: blue;', data);
            
            try {
                const response = await fetch(API_URL + path, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json' 
                    },
                    body: JSON.stringify(data) 
                });

                
                const responseData = await response.json();

                if (!response.ok) { 
                    throw responseData; // 7장에서 만든 에러 객체가 여기로!
                }

                console.log('%c[응답] 성공:', 'color: green;', responseData);

            } catch (error) {
        
                // 여기서 7장에서 만든 { resultType: "FAIL", error: { ... } } 객체가 찍힙니다.
                console.error('%c[응답] 실패:', 'color: red;', error);
            }
        }
    </script>
</body>
</html>